#Summarize and plot the results generated by simulation output
#input files:
#Original16, Original32, Original48, Rate05, Rate1, Rate2, Rate3
#Output:Summary output
###############################################################################
rm(list=ls())
library(xlsx)
library(xlsxjars)
library(rJava)
library(ggplot2)
#Import and Merge Result files###############################################################################

Rate05 <- read.xlsx(file="Simulation Results/Rate05.xlsx",sheetIndex=1)
Rate1 <- read.xlsx(file="Simulation Results/Rate1.xlsx",sheetIndex=1)
Rate2 <- read.xlsx(file="Simulation Results/Rate2.xlsx",sheetIndex=1)
Rate3 <- read.xlsx(file="Simulation Results/Rate3.xlsx",sheetIndex=1)
Rate4 <- read.xlsx(file="Simulation Results/Rate4.xlsx",sheetIndex=1)
tuning<- rbind(Rate05,Rate1,Rate2,Rate3,Rate4)

tuning$Method <- as.character(tuning$Method)  
tuning$Method[tuning$Method=="Rate=0.5"] <- "0.5"
tuning$Method[tuning$Method=="Rate=1"] <- "1"
tuning$Method[tuning$Method=="Rate=2"] <- "2"
tuning$Method[tuning$Method=="Rate=3"] <- "3"
tuning$Method[tuning$Method=="Rate=4"] <- "4"
names(tuning)[1] <- "ID"
tuning <- reshape(tuning, varying=c("Select.Best", "Select.Good", "Treat.Best", "Treat.Good"),
                  v.names="Value",timevar="Characteristic", times=c("Select.Best", "Select.Good", "Treat.Best", "Treat.Good"),
              new.row.names=1:10000,direction="long")
tuning <- tuning[,seq(1:6)]
avg.tuning <- aggregate(tuning,by=list(tuning$Toxicity,tuning$Efficacy, tuning$Characteristic),FUN="mean" )
avg.tuning <- avg.tuning[,c(1,2,3,9)]
avg.tuning[1:3,]
names(avg.tuning) <- c("Toxicity","Efficacy","Characteristic","Average")
tuning <- merge(tuning,avg.tuning)
tuning <- cbind(tuning,tuning$Value-tuning$Average)
names(tuning)[8] <- "Relative_Difference"



tuning[tuning$Toxicity=="T4" & tuning$Efficacy=="R1" & tuning$Characteristic =="Select.Best",]

#Making Plots for tuning #########################################################################################
data.plot <- subset.data.frame(tuning, Characteristic ==c("Select.Best"))

p1 <- ggplot(data.plot ,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p1 <- p1+ylab("Relative Performance")+xlab(expression(delta))+labs(title="Select Best Dose")
p1 <- +geom_hline(yintercept=0)
data.plot  <- subset.data.frame(tuning, Characteristic ==c("Select.Good"))
p2 <- ggplot(data.plot ,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p2 <- p2+ylab("Relative Performance")+xlab(expression(delta))+labs(title="Select Good Dose")
p2 <- p2+geom_hline(yintercept=0)
data.plot  <- subset.data.frame(tuning, Characteristic ==c("Treat.Best"))
p3 <- ggplot(data.plot ,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p3 <- p3+ylab("Relative Performance")+xlab(expression(delta))+labs(title="Treat at Best Dose")
p3 <- p3+geom_hline(yintercept=0)
data.plot  <- subset.data.frame(tuning, Characteristic ==c("Treat.Good"))
p4 <- ggplot(data.plot,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p4 <- p4+ylab("Relative Performance")+xlab(expression(delta))+labs(title="Treat at Good Dose")
p4 <- p4+geom_hline(yintercept=0)
library(cowplot)
p <- plot_grid(p1, p2, p3,p4, labels=c("A", "B","C","D"), ncol = 2, nrow = 2)
windows() 
p
###############################################################################################################
#Compare to original method####################################################################################
###############################################################################################################
rm(list=ls())
library(xlsx)
library(xlsxjars)
library(rJava)
library(ggplot2)
#Import and Merge Result files###############################################################################
Original16 <- read.xlsx(file="Simulation Results/Original16.xlsx",sheetIndex=1)
Original32 <- read.xlsx(file="Simulation Results/Original32.xlsx",sheetIndex=1)
Original48 <- read.xlsx(file="Simulation Results/Original48.xlsx",sheetIndex=1)
Rate2 <- read.xlsx(file="Simulation Results/Rate2.xlsx",sheetIndex=1)
Rate3 <- read.xlsx(file="Simulation Results/Rate3.xlsx",sheetIndex=1)
comparison <-rbind(Original16,Original32,Original48,Rate2,Rate3) 
names(comparison)[1] <- "ID"
comparison$Method <- as.character(comparison$Method)  
comparison$Method[comparison$Method=="Original"] <- "WT-16"
comparison$Method[comparison$Method=="Original32"] <- "WT-32"
comparison$Method[comparison$Method=="Original48"] <- "WT-48"
comparison$Method[comparison$Method=="Rate=2"] <- "Delta=2"
comparison$Method[comparison$Method=="Rate=3"] <- "Delta=3"
comparison <- reshape(comparison, varying=c("Select.Best", "Select.Good", "Treat.Best", "Treat.Good"),
                      v.names="Value",timevar="Characteristic", times=c("Select.Best", "Select.Good", "Treat.Best", "Treat.Good"),
                      new.row.names=1:10000,direction="long")
comparison <- comparison[,1:6]
avg.comparison <- aggregate(comparison,by=list(comparison$Toxicity,comparison$Efficacy, comparison$Characteristic),FUN="mean" )
avg.comparison <- avg.comparison[,c(1,2,3,9)]

names(avg.comparison) <- c("Toxicity","Efficacy","Characteristic","Average")
comparison <- merge(comparison,avg.comparison)
comparison <- cbind(comparison, comparison$Value-comparison$Average)
names(comparison)[8] <- "Relative_Difference"

data.plot <- subset.data.frame(comparison, Characteristic ==c("Select.Best"))
p1 <- ggplot(data.plot ,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p1 <- p1+ylab("Relative Performance")+xlab("Design Method")+geom_hline(yintercept=0)+labs(title="Select Best Dose")+ theme(axis.text.x = element_text(angle = 45, hjust = 1))
data.plot  <- subset.data.frame(comparison, Characteristic ==c("Select.Good"))
p2 <- ggplot(data.plot ,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p2 <- p2+ylab("Relative Performance")+xlab("Design Method")+geom_hline(yintercept=0)+labs(title="Select Good Dose")+ theme(axis.text.x = element_text(angle = 45, hjust = 1))
data.plot  <- subset.data.frame(comparison, Characteristic ==c("Treat.Best"))
p3 <- ggplot(data.plot ,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p3 <- p3+ylab("Relative Performance")+xlab("Design Method")+geom_hline(yintercept=0)+labs(title="Treat at Best Dose")+ theme(axis.text.x = element_text(angle = 45, hjust = 1))
data.plot  <- subset.data.frame(comparison, Characteristic ==c("Treat.Good"))
p4 <- ggplot(data.plot,aes(x=Method,y=Relative_Difference))+geom_bar(stat = "identity",position = "dodge")+facet_grid( Toxicity~ Efficacy)
p4 <- p4+ylab("Relative Performance")+xlab("Design Method")+geom_hline(yintercept=0)+labs(title="Treat at Good Dose")+ theme(axis.text.x = element_text(angle = 45, hjust = 1))
library(cowplot)
p <- plot_grid(p1, p2, p3,p4, labels=c("A", "B","C","D"), ncol = 2, nrow = 2)
windows() 
p
